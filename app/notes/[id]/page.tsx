import { fetchNotes } from "@/lib/api";
import NotesClient from "../Notes.client";
import {
  QueryClient,
  dehydrate,
  HydrationBoundary,
} from "@tanstack/react-query";

/**
 * –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫ (/notes)
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç SSR-–∑–∞–≥—Ä—É–∑–∫—É –∑–∞–º–µ—Ç–æ–∫ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
 */
export default async function NotesPage() {
  const queryClient = new QueryClient();

  // üîπ –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫ –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  const data = await fetchNotes({ page: 1 });

  // üîπ –ü—Ä–µ—Ñ–µ—Ç—á–∏–º –∏—Ö –≤ React Query –∫—ç—à
  await queryClient.prefetchQuery({
    queryKey: ["notes", 1],
    queryFn: () => fetchNotes({ page: 1 }),
  });

  // üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–∞–º–µ—Ç–∫–∞–º–∏
  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      <NotesClient initialNotes={data.notes} />
    </HydrationBoundary>
  );
}
